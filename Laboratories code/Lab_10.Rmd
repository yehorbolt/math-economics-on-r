---
title: "Lab_10"
output:
  word_document: default
  html_document: default
date: "2023-04-19"
---

# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ10

# –ú–æ–¥–µ–ª—å–Ω–∞ –¥—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞. 

–û–ø–∏—Å dataset

–ù–∞–∑–≤–∞ dataset:
Spotify Top 10000 Streamed Songs

Link –Ω–∞ dataset: 
https://www.kaggle.com/datasets/rakkesharv/spotify-top-10000-streamed-songs

–û–ø–∏—Å dataset —Ç–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–¥–∞—á—ñ:
–¶–µ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö, –∑—ñ–±—Ä–∞–Ω–∏–π –∑ –≤–µ–±-—Å–∞–π—Ç—É Spotify, –∫–æ—Ç—Ä–∏–π –º—ñ—Å—Ç–∏—Ç—å –ø–æ—Ç–æ–∫–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü—è
—Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ—Å–ª—ñ—Ö–æ–≤—É–≤–∞–Ω—å (–±—É–ª–æ –≤–∑—è—Ç–æ —Å–∞–º–µ —Ç–æ–ø-10000)
–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞: –≤–ø–ª–∏–≤ —Ñ–∞–∫—Ç–æ—Ä—ñ–≤ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å –ø—ñ—Å–Ω—ñ –π –¥—ñ–∑–Ω–∞—Ç–∏—Å—å –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏—Ö
–≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ —Ç–∞ —Ç—Ä–µ–∫–∏.

–ó–º—ñ–Ω–Ω—ñ —Ç–∞ —ó—Ö –æ–ø–∏—Å:
Position - Spotify Ranking
Artist Name - Artist Name
Song Name - Song Name
Days - No of days since the release of the song (Updated)
Top 10 (xTimes) - No of times inside top 10
Peak Position - Peak position attained
Peak Position (xTimes) - No of times Peak position attained
Peak Streams - Total no of streams during Peak position
Total Streams - Total song streams 


```{r}
library(car)
library(readr)
library(plotly)
library(GGally)
library(ggplot2)
library(glmnet)

df <- read_csv("../Spotify_final_dataset.csv")
```

# –ó–∞–≤–¥–∞–Ω–Ω—è 1: –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞.

(A) –ü–æ—á–∏—Å—Ç–∏—Ç–∏ dataset –≤—ñ–¥ –≤—Å—ñ—Ö NA's –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é data <- na.omit(data)
```{r}
df <- na.omit(df)
```


(B) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –º–∞—Ç—Ä–∏—Ü—é ùë•;
```{r}
x1 <- df$Peak_position_times
x2 <- df$Peak_streams
x3 <- df$Days
x4 <- df$Total_streams

x <- model.matrix(Peak_position ~ 0 + x1 + x2 + x3 + x4, data=df)
```


(C) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤–µ–∫—Ç–æ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥–µ–π ùë¶.
```{r}
y <- df$Top_ten_times
```



# –ó–∞–≤–¥–∞–Ω–Ω—è 2: –ü–æ–±—É–¥–æ–≤–∞ –º–æ–¥–µ–ª—ñ –•—Ä–µ–±—Ç–∞.

(A) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –º–æ–¥–µ–ª—å —Ä–µ–≥—Ä–µ—Å—ñ—ó –•—Ä–µ–±—Ç–∞;
```{r}
ridgeMod <- glmnet(x = x, y = y, alpha = 0)
ridgeMod
```


(B) –ó—Ä–æ–±–∏—Ç–∏ –ø—ñ–¥—Å—É–º–æ–∫ –º–æ–¥–µ–ª—ñ –∑–∞ ùëÖ^2, F-stat, RSE
```{r}
mod <- lm(y~x)
summary(mod)
```
–î–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ —Å—Ç–æ—Å—É—é—Ç—å—Å—è —Ä–µ–≥—Ä–µ—Å—ñ–π–Ω–æ—ó –º–æ–¥–µ–ª—ñ, —è–∫–∞ –º–∞—î –¥—É–∂–µ –≤–∏—Å–æ–∫–µ –∑–Ω–∞—á–µ–Ω–Ω—è F-—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ç–∞ –¥—É–∂–µ –Ω–∏–∑—å–∫–∏–π —Ä—ñ–≤–µ–Ω—å –∑–Ω–∞—á–∏–º–æ—Å—Ç—ñ p-value, —â–æ –æ–∑–Ω–∞—á–∞—î, —â–æ —î –∑–≤'—è–∑–æ–∫ –º—ñ–∂ –∑–∞–ª–µ–∂–Ω–æ—é —Ç–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏–º–∏ –∑–º—ñ–Ω–Ω–∏–º–∏ –≤ –º–æ–¥–µ–ª—ñ (—Ü–µ –≤—Å–µ –≥—ñ–ø–æ—Ç–µ—Ç–∏—á–Ω–æ).
R^2 –¥–æ—Ä—ñ–≤–Ω—é—î 0.7227, —â–æ —î –Ω–µ –¥–æ—Å–∏—Ç—å —Ç–æ—á–Ω–æ, –∞–ª–µ –π –º–∞—î –ø—Ä–∞–≤–æ –Ω–∞ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è –¥–∞–Ω–∞ –º–æ–¥–µ–ª—å.
RSE —Ä—ñ–≤–Ω–∏–π 8.22

(C) –û–±—á–∏—Å–ª–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è RSS
```{r}
RSS <- sum(y-mod$fitted.values)^2
RSS
```
–ó–Ω–∞—á–µ–Ω–Ω—è –Ω–∞–±–ª–∏–∂–µ–Ω–µ –¥–æ 0 –∫–∞–∂–µ –Ω–∞–º –ø—Ä–æ —Ç–æ—á–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª—ñ



# –ó–∞–≤–¥–∞–Ω–Ω—è 3: –í—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—è –º–æ–¥–µ–ª—ñ –•—Ä–µ–±—Ç–∞.

(A) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è xvar = "norm";
```{r}
plot(ridgeMod, xvar = "norm", label = TRUE)
```


(B) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è xvar = " lambda";
```{r}
plot(ridgeMod, label = TRUE, xvar = "lambda")
ridgeMod$lambda
```


(C) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è xvar = "dev";
```{r}
plot(ridgeMod, label = TRUE, xvar = "dev")
```


(D) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è ùëÖ^2;
–í–∏—Ö–æ–¥–∏—Ç—å –∑–∞ 0.7


(E) –í–∏–∑–Ω–∞—á–∏—Ç–∏ —Ç—Ä–∏ –≤–∞–∂–ª–∏–≤—ñ —Ñ–∞–∫—Ç–æ—Ä–∏ —Ç–∞ –≤–∏–≤–µ—Å—Ç–∏ —ñ—Ö –Ω–∞–∑–≤–∏;
```{r}
colnames(x)[c(1,2,4)]
```


(F) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é —Ç–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–∏–ø—É–∂–µ–Ω–Ω—è –ø—Ä–æ –∑–Ω–∞—á–µ–Ω–Ω—è log(lambda)
plot(log(ridgeMod$lambda), ridgeMod$dev.ratio, type = "l",xlab = "log(lambda)", ylab = "R2")
```{r}
plot(log(ridgeMod$lambda), ridgeMod$dev.ratio, type = "l",
     xlab = "log(lambda)", ylab = "R2")
```


# –ó–∞–≤–¥–∞–Ω–Ω—è 4: –¢–æ–Ω–∫—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

(A) –í–∏–∑–Ω–∞—á–∏—Ç–∏ ùëÖ^2 –º–µ—Ç–æ–¥–æ–º –•—Ä–µ–±—Ç–∞ —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º –≤ Lm()
ridgeMod$dev.ratio[length(ridgeMod$dev.ratio)]
```{r}
ridgeMod$dev.ratio[length(ridgeMod$dev.ratio)]
```
–í—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è –≤—ñ–¥ –¥–∞–Ω–æ–≥–æ (0.7226)

(B) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–ª—å–Ω–∏—Ö –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ a0;
```{r}
length(ridgeMod$a0)
```


(C) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –≤—ñ–ª—å–Ω–∏—Ö –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ beta;
```{r}
length(ridgeMod$beta)
```


(D) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ lambda, —è–∫—ñ –≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ;
```{r}
length(ridgeMod$lambda)
```


(E) –í–∏–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –¥–ª—è –ø–µ–≤–Ω–æ–≥–æ lambda;
```{r}
coef(ridgeMod)[, 19]
```


(F) –í–∏–≤–µ—Å—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è lambda;
```{r}
ridgeMod$lambda[19]
```


(G) –í—ñ–∑—É–∞–ª—å–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∏ –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ lambda.
```{r}
plot(ridgeMod, label = TRUE, xvar = "lambda",
     xlim = log(ridgeMod$lambda[19]) + c(-2, 2), ylim = c(-30, 10))
abline(v = log(ridgeMod$lambda[19]))
points(rep(log(ridgeMod$lambda[19]), nrow(ridgeMod$beta)), ridgeMod$beta[, 19],
       pch = 16, col = 1:6)
ridgeMod$beta[, 19]
```


(H) –í—ñ–∑—É–∞–ª—å–Ω–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–Ω—è –¥–ª—è l^2 –Ω–æ—Ä–º–∏
plot(log(ridgeMod$lambda), sqrt(colSums(ridgeMod$beta^2)), type = "l", xlab = "log(lambda)", ylab = "l2
norm")
```{r}
plot(log(ridgeMod$lambda), sqrt(colSums(ridgeMod$beta^2)), type = "l", xlab = "log(lambda)", ylab = "l2
norm")
```



# –ó–∞–≤–¥–∞–Ω–Ω—è 5: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

(A) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–ª—è lambda;
```{r}
set.seed(7777)
kcvRidge <- cv.glmnet(x=x, y=y, alpha=0, nfolds = 10)
kcvRidge$lambda.min
```


(B) –í–∏–∑–Ω–∞—á–∏—Ç–∏ —ñ–Ω–¥–µ–∫—Å –¥–ª—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–Ω—è lambda;
```{r}
indMinLambda <- which.min(kcvRidge$cvm)
kcvRidge$lambda[indMinLambda]
```


(C) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –º—ñ–Ω—ñ–º–∞–ª—å–Ω–æ—ó –ø–æ—Ö–∏–±–∫—É CV;
```{r}
ridgeMod$lambda[indMinLambda]
```


(D) –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å—ñ—Ç–∫—É –∑ —á–∞—Å–æ–≤–∏—Ö —ñ–Ω—Ç–µ—Ä–≤–∞–ª—ñ–≤;
```{r}
lambdaGrid <- 10^seq(log10(kcvRidge$lambda[1]), log10(0.1),
                    length.out = 150) 
lambdaGrid
```


(E) –ü–æ–±—É–¥—É–≤–∞—Ç–∏ –≤—ñ–∑—É–∞–∑—ñ–∑–∞—Ü—ñ—é –¥–ª—è ùëôùëúùëî ùúÜ
```{r}
kcvRidge2 <- cv.glmnet(x = x, y = y, nfolds = 10, alpha = 0,
                       lambda = lambdaGrid)
plot(kcvRidge2)
```


(F) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è CV
```{r}
kcvRidge2$lambda.min
kcvRidge2$lambda.1se
```


(G) –í—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–∞–π–Ω–∏–∂—á–µ –∑–Ω–∞—á–µ–Ω–Ω—è –°V —Ç–∞ –π–æ–≥–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è;
```{r}
plot(kcvRidge2)
indMin2 <- which.min(kcvRidge2$cvm)
abline(h = kcvRidge2$cvm[indMin2] + c(0, kcvRidge2$cvsd[indMin2]))
```


(H) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∏–π CV –¥–ª—è –Ω–∞–π–±—ñ–ª—å—à–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –≥—Ä—É–ø nfolds = nrow(data)
```{r}
ncvRidge <- cv.glmnet(x = x, y = y, alpha = 0, nfolds = nrow(df),
                      lambda = lambdaGrid)
ncvRidge$lambda.min
```


(I) –í–∏–∫–æ–Ω–∞—Ç–∏ –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è (H)
```{r}
plot(ncvRidge)
```


# –ó–∞–≤–¥–∞–Ω–Ω—è 6: –ü—Ä–æ–≥–Ω–æ–∑—É–≤–∞–Ω–Ω—è

(A) –í–∏–∑–Ω–∞—á–∏—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ –º–æ–¥–µ–ª—ñ –∑–∞ –°V –¥–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ–≥–æ lambda;
```{r}
modRidgeCV <- kcvRidge2$glmnet.fit
plot(modRidgeCV, label = TRUE, xvar = "lambda")
abline(v = log(c(kcvRidge2$lambda.min, kcvRidge2$lambda.1se)))
predict(modRidgeCV, type = "coefficients", s = kcvRidge2$lambda.1se)
```


(B) –í–∏–∫–æ–Ω–∞—Ç–∏ –ø—Ä–æ–≥–Ω–æ—Ö –¥–ª—è –ø–µ—Ä—à–∏—Ö –¥–≤–æ—ó –∑–Ω–∞—á–µ–Ω—å;
```{r}
predict(modRidgeCV, type = "response", s = kcvRidge2$lambda.1se,
        newx = x[1:2, ])
```


(C) –ó–≤—ñ–∑—É–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–∞ —Å–∫—ñ–ª—å–∫–∏ –∑–º—ñ–Ω—è—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–Ω—è –ø—Ä–æ–≥–Ω–æ–∑—É –¥–ª—è —Ä—ñ–∑–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω—å lambda.
```{r}
plot(log(modRidgeCV$lambda),
     predict(modRidgeCV, type = "response", newx = x[1, , drop = FALSE]),
     type = "l", xlab = "log(lambda)", ylab = " Prediction")
```

