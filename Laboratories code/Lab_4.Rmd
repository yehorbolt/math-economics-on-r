---
title: "Lab_2.3"
output: word_document
date: "2023-03-07"
---

# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞ —Ä–æ–±–æ—Ç–∞ ‚Ññ2 (—á–∞—Å—Ç–∏–Ω–∞ 3)

# –ü–æ–±—É–¥–æ–≤–∞ —Ç–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–Ω–∏–π –∞–Ω–∞–ª—ñ–∑ –ª—ñ–Ω—ñ–π–Ω–æ—ó –º–Ω–æ–∂–∏–Ω–Ω–æ—ó —Ä–µ–≥—Ä–µ—Å—ñ—ó.

–û–ø–∏—Å dataset

–ù–∞–∑–≤–∞ dataset:
Spotify Top 10000 Streamed Songs

Link –Ω–∞ dataset: 
https://www.kaggle.com/datasets/rakkesharv/spotify-top-10000-streamed-songs

–û–ø–∏—Å dataset —Ç–∞ –ø–æ—Å—Ç–∞–Ω–æ–≤–∫—É –∑–∞–¥–∞—á—ñ:
–¶–µ –Ω–∞–±—ñ—Ä –¥–∞–Ω–∏—Ö, –∑—ñ–±—Ä–∞–Ω–∏–π –∑ –≤–µ–±-—Å–∞–π—Ç—É Spotify, –∫–æ—Ç—Ä–∏–π –º—ñ—Å—Ç–∏—Ç—å –ø–æ—Ç–æ–∫–∏ –≤–∏–∫–æ–Ω–∞–≤—Ü—è
—Ç–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–æ—Å–ª—ñ—Ö–æ–≤—É–≤–∞–Ω—å (–±—É–ª–æ –≤–∑—è—Ç–æ —Å–∞–º–µ —Ç–æ–ø-10000)
–û—Å–Ω–æ–≤–Ω–∞ –º–µ—Ç–∞: –≤–ø–ª–∏–≤ —Ñ–∞–∫—Ç–æ—Ä—ñ–≤ –Ω–∞ –ø–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å –ø—ñ—Å–Ω—ñ –π –¥—ñ–∑–Ω–∞—Ç–∏—Å—å –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏—Ö
–≤–∏–∫–æ–Ω–∞–≤—Ü—ñ–≤ —Ç–∞ —Ç—Ä–µ–∫–∏.

–ó–º—ñ–Ω–Ω—ñ —Ç–∞ —ó—Ö –æ–ø–∏—Å:
Position - Spotify Ranking
Artist Name - Artist Name
Song Name - Song Name
Days - No of days since the release of the song (Updated)
Top 10 (xTimes) - No of times inside top 10
Peak Position - Peak position attained
Peak Position (xTimes) - No of times Peak position attained
Peak Streams - Total no of streams during Peak position
Total Streams - Total song streams 


# –ó–∞–≤–¥–∞–Ω–Ω—è 7: ANOVA

```{r}
library(readr)
library(plotly)
library(GGally)
library(ggplot2)
df <- read_csv("../Spotify_final_dataset.csv")

Y <- df$Top_ten_times
x1 <- df$Peak_position_times
x2 <- df$Peak_streams
x3 <- df$Days
x4 <- df$Total_streams
x5 <- df$Peak_position

x1_scaled <- scale(x1)
x2_scaled <- scale(x2)
x3_scaled <- scale(x3)
x4_scaled <- scale(x4)
x5_scaled <- scale(x5)
dataCen <- data.frame(scale(df[c(1,4:9)] , center = TRUE,scale = FALSE))

mod2 <- lm(Y ~ x1_scaled + x2_scaled)
mod3 <- lm(Y ~ x1_scaled + x2_scaled + x3_scaled + x4_scaled + x5_scaled)
smod3 <- summary(mod3)
smod2 <- summary(mod2)
mod1 <- lm(Y ~ x1_scaled)
smod1 <- summary(mod1)
```

(A) –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —Ñ—É–Ω–∫—Ü—ñ—é simpleAnova, –≤–∏–≤–µ–¥—ñ—Ç—å —Å–ø—Ä–æ—â–µ–Ω—É —Ç–∞–±–ª–∏—Ü—é ANOVA –¥–ª—è:

a. –º–æ–¥–µ–ª—ñ mod2
```{r}
simpleAnova <- function(object, ...) {
  
  # –û–±—á–∏—Å–ª–∏—Ç–∏ —Ç–∞–±–ª–∏—Ü—é anova
  tab <- anova(object, ...)
  
  # –û—Ç—Ä–∏–º–∞—Ç–∏ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä—ñ–≤
  p <- nrow(tab) - 1
  
  # –î–æ–¥–∞–π—Ç–µ —Ä—è–¥–æ–∫ –ø—Ä–µ–¥–∏–∫—Ç–æ—Ä—ñ–≤
  predictorsRow <- colSums(tab[1:p, 1:2])
  predictorsRow <- c(predictorsRow, predictorsRow[2] / predictorsRow[1])
  
  # F-–∑–Ω–∞—á–µ–Ω–Ω—è
  Fval <- predictorsRow[3] / tab[p + 1, 3]
  pval <- pf(Fval, df1 = p, df2 = tab$Df[p + 1], lower.tail = FALSE)
  predictorsRow <- c(predictorsRow, Fval, pval)
  
  # –°–ø—Ä–æ—â–µ–Ω–∞ —Ç–∞–±–ª–∏—Ü—è
  tab <- rbind(predictorsRow, tab[p + 1, ])
  row.names(tab)[1] <- "Predictors"
  return(tab)
  
}
simpleAnova(mod2)
```

b. –º–æ–¥–µ–ª—ñ mod3
```{r}
simpleAnova(mod3)
```


(B) –ó—Ä–æ–±—ñ—Ç—å –∞–Ω–∞–ª—ñ–∑ —Ç–∞–±–ª–∏—Ü—å –¥–ª—è –º–æ–¥–µ–ª–µ–π mod2 —Ç–∞ mod3:


# –ó–∞–≤–¥–∞–Ω–Ω—è 8: –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –∞–¥–µ–∫–≤–∞—Ç–Ω–æ—Å—Ç—ñ –º–æ–¥–µ–ª—ñ –∑–∞ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞–º–∏ ùëπ^ùüê—Ç–∞ ùëÖAdj^2

(A) –í–∏–∫–æ–Ω–∞–π—Ç–µ 3D –≤—ñ–∑—É–∞–ª—ñ–∑–∞—Ü—ñ—é –¥–ª—è mod2:
car::scatter3d(y ~ x1 + x2, fit = "linear")
rgl::rglwidget()
```{r}
car::scatter3d(Y ~ x1_scaled + x2_scaled, fit = "linear")
rgl::rglwidget()
```

(B) –û–±—á–∏—Å–ª—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è ùëÖ^2 –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ–æ—Ä–º—É–ª –¥–ª—è mod1 —Ç–∞ mod0;
ùëÖ^2 = 1 ‚àí (SSE/SST)
```{r}
mod0 <- lm(Y ~ 0 + x1_scaled)
smod0 <- summary(mod0)

Rsquared <- function(object, ...) {
sse <- sum((fitted(object) - Y)^2)
ssr <- sum((fitted(object) - mean(Y))^2)
sst <- ssr + sse
Rsq <- 1 - (sse/sst)
return(Rsq)
}

Rsquared(mod0)
Rsquared(mod1)
```

(C) –û–±—á–∏—Å–ª—ñ—Ç—å ùëÖAdj^2 –¥–ª—è –º–æ–¥–µ–ª—ñ mod1 —Ç–∞ mod0 —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–π—Ç–µ –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏
–∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ ùëÖ^2

```{r}
AdjRsquared <- function(object, param, ...) {
sse <- sum((fitted(object) - Y)^2)
ssr <- sum((fitted(object) - mean(Y))^2)
sst <- ssr + sse
ARsq <- 1 - (sse/sst)*((length(Y)-1)/((length(Y)-param-1)))
return(ARsq)
}

AdjRsquared(mod0,2)
AdjRsquared(mod1,1)
```

–ü–æ—Ä—ñ–≤–Ω—è—Ç–∏ –∑:
```{r}
Rsquared(mod0)
Rsquared(mod1)
```



(D) –í–∫–∞–∂—ñ—Ç—å –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ ùëÖ^2
—Ç–∞ ùëÖAdj^2 –¥–ª—è mod1, mod2 —Ç–∞ mod3. 
–ó—Ä–æ–±—ñ—Ç—å –≤–∏—Å–Ω–æ–≤–æ–∫,—è–∫–∞ –º–æ–¥–µ–ª—å, —É –≤–∞—à–æ–º—É –≤–∏–ø–∞–¥–∫—É, —î –Ω–∞–π–∫—Ä–∞—â–æ—é.

R-squared
```{r}
smod1$r.squared 
smod2$r.squared 
smod3$r.squared 
```

Adj. R-squared
```{r}
smod1$adj.r.squared
smod2$adj.r.squared
smod3$adj.r.squared 
```
–ó–∞ –¥–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏ –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ —â–æ –Ω–∞–π–∫—Ä–∞—â–∞ –º–æ–¥–µ–ª—å -  mod3


# –ó–∞–≤–¥–∞–Ω–Ω—è 9: –ú–æ–¥–µ–ª—å –±–µ–∑ –≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ —Ç–∞ —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω—ñ –º–æ–¥–µ–ª—ñ

(A) –ü–æ–±—É–¥—É–π—Ç–µ –º–æ–¥–µ–ª—å –±–µ–∑ –≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç–∞ –¥–ª—è 1-–Ω–æ —Ñ–∞–∫—Ç–æ—Ä–Ω–æ—ó –º–æ–¥–µ–ª—ñ (mod0)
ùëå = 0 + ùõΩ1ùëã1 + ùúÄ. –¶–µ –º–æ–∂–Ω–∞ –≤–∏–∫–æ–Ω–∞—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é mod0 <- lm(y ~ 0 + x1, data):
```{r}
mod0 <- lm(Y ~ 0 + x1)
summary(mod0)
```

(B) –ü–æ–±—É–¥—É–π—Ç–µ —Ä–æ–∑—Å—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ –Ω–∞–∫–ª–∞–¥—ñ—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –ø—Ä—è–º—ñ —Ä–µ–≥—Ä–µ—Å—ñ—è –¥–ª—è –º–æ–¥–µ–ª–µ–π mod1 —Ç–∞ mod0;
```{r}
plot(x1, Y)
abline(mod1, col="blue")
abline(mod0, col="red")
```

(C) –í–∏–∫–æ–Ω–∞—î–º–æ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω—ñ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∞–Ω–æ–≥–æ dataset (dataCen)

a. –ü–æ–±—É–¥—É–π—Ç–µ mod0 —Ç–∞ mod1 –¥–ª—è dataCen;
```{r}
x1_cen <- dataCen$Peak_position_times

mod1_cen <- lm(Y ~  x1_cen)
mod0_cen <- lm(Y ~ 0 + x1_cen)
summary(mod0_cen)
```

b. –û–±—á–∏—Å–ª—ñ—Ç—å —Ç–∞ –ø–æ—Ä—ñ–≤–Ω—è–π—Ç–µ –∑–Ω–∞—á–µ–Ω–Ω—è –∫–æ–µ—Ñ—ñ—Ü—ñ—î–Ω—Ç—ñ–≤ ùëÖ^2 —Ç–∞ ùëÖAdj^2 –¥–ª—è –º–æ–¥–µ–ª–µ–π 
mod0 —Ç–∞ mod1 –∑ –ø—É–Ω–∫—Ç—É (a);
```{r}
summary(mod0_cen)$r.squared 
summary(mod1_cen)$r.squared 

summary(mod0_cen)$adj.r.squared 
summary(mod1_cen)$adj.r.squared 

# –ü–æ–±—É–¥–æ–≤–∞ —Ä–æ–∑—Å—ñ—é–≤–∞–Ω–Ω—è —Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ mod0 —Ç–∞ mod1
plot(x1_cen, Y)
abline(mod1_cen, col="blue")
abline(mod0_cen, col="red")
```
